# Example nginx configuration for maap.to
# Copy this to your nginx sites-available and adjust paths as needed

server {
    listen 80;
    server_name maap.to www.maap.to;

    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name maap.to www.maap.to;

    # SSL certificates (adjust paths)
    ssl_certificate /etc/letsencrypt/live/maap.to/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/maap.to/privkey.pem;

    # Root directory (adjust path)
    root /var/www/maap.to;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml image/svg+xml;

    # Cache static assets
    location ~* \.(gif|jpg|jpeg|png|svg|ico|css|js|woff|woff2)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # Landing page
    location = / {
        try_files /index.html =404;
    }

    # Explicit HTML files
    location ~ ^/(index|game)\.html$ {
        try_files $uri =404;
    }

    # Static directories - serve directly
    location ~ ^/(js|css|resources|maps|supabase)/ {
        try_files $uri =404;
    }

    # API proxy to Supabase Edge Functions (if needed)
    location /api/ {
        # Adjust to your Supabase project URL
        proxy_pass https://YOUR_PROJECT_ID.supabase.co/functions/v1/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Username routes - serve game.html for any other path
    # The JS will parse the username from the URL
    location / {
        try_files $uri /game.html;
    }
}
